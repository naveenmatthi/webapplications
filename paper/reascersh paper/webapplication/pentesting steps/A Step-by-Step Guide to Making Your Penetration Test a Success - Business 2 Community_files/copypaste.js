window.postPlatformApp.register("copypaste",function(b){var c=b._,h,f,k;h=Object.freeze({additionalScroll:20,postBlockClassName:"pw-hidden-cp",serviceName:"Clipboard"});k=c.isMobile()?"copy":b.ext.pwConfig.val("shareQuoteOptions.trigger");f={init:function(a){var d=c.sGUID();b.state.set(c.extend(a,{sGUID:d,readMoreText:a.readMoreText,shareUrl:this.getUrlForCopyPaste(d,a.readMoreUrl),duplication:!1}));c.bindAll(this,["onCopy","doSharequote"]);if("select"===k)c.on(document.body,"mouseup",this.doSharequote,
!1);this.copyEvent=c.on(document.body,"copy",this.onCopy,!1,!1)},update:function(){var a=c.sGUID();b.state.set({sGUID:a,shareUrl:this.getUrlForCopyPaste(a,b.state.get("readMoreUrl"))})},shareQuoteOpen:function(){return"block"===c.prop(c.get(".pw-sharequote")[0],"style.display")},destroy:function(){c.off(document.body,"copy",this.copyEvent)},getReadMoreText:function(){var a=b.state.get("readMoreText"),d=b.ext.i18n.t("readMore");c.isUndefined(a)||(a?c.isString(a)&&(d=a):d="");return d},onCopy:function(a){a=
this.checkSelection(a);c.isUndefined(a)||this.formatCopiedText(a)},shareQuoteShow:function(a){a.replace(/^\s+|\s+$/g,"").split(/\s+/).length>=b.state.get("minWords")&&b.publish("shareQuote.show",{copiedText:a})},doCopypasteShare:function(a){var d=h.serviceName,e=c.removeTrackingParameter(b.state.get("shareUrl"));b.publish("googleAnalytics.track",{service:d,url:e});b.publish("counter.increment",{publisherKey:b.ext.pwConfig.val("publisherKey"),channel:d.toLowerCase(),url:e});c.doFunction(b.ext.pwConfig.val("defaults.handlers.onshare"),
{service:d.toLowerCase()});b.publish("datalogger.log",{eventName:"share",options:{sc1:d.toLowerCase(),sGUID:b.state.get("sGUID"),vGUID:b.ext.pwConfig.val("vguid")||c.getGUID(!0),sm:b.ext.pwConfig.val("mode"),pub:b.ext.pwConfig.val("publisherKey"),pt:b.ext.pwConfig.val("defaults.title")||b.ext.pwConfig.specific().title,pu:e,text:a.substr(0,2E3),ru:c.getDocumentProperty("referrer"),random:c.getTimeStamp()}})},doSharequote:function(a){a=this.checkSelection(a);var d=(a||"").replace(/^\s+|\s+$/g,"").split(/\s+/).length;
this.shareQuoteOpen()||!c.isUndefined(a)&&d>=b.state.get("minWords")&&this.shareQuoteShow(a)},formatCopiedText:function(a){var d=a.replace(/^\s+|\s+$/g,"").split(/\s+/).length,c=window.getSelection().getRangeAt(0).cloneRange(),g=this.getReadMoreText(),f;if(d>=b.state.get("minWords")||this.hasImage())this.doCopypasteShare(a),"copy"===k&&d>=b.state.get("minWords")&&this.shareQuoteShow(a),g&&this.textUpdater(g),setTimeout(function(){f=window.getSelection();f.removeAllRanges();f.addRange(c)},0)},appendUrlToImages:function(a){var d;
(a=c.get("img",a))&&c.each(a,function(a){d=c.createNode("p",{innerHTML:"image: "+a.src});a.parentNode.insertBefore(d,a)})},textUpdater:function(a){var d,e,g;if(b.state.get("duplication"))return!1;b.state.set({duplication:!0});d=c.createNode("a",{href:b.state.get("shareUrl"),innerHTML:encodeURIComponent(b.state.get("shareUrl")),style:{color:"#003399"}});a=a.replace(RegExp("{link}","g"),d);g=c.createNode("span",{innerHTML:"\x3cbr/\x3e"+a});e=c.createNode("div",{"class":h.postBlockClassName});a=window.getSelection();
d=document.createRange();c.appendTo("body",e);c.appendTo(e,a.getRangeAt(0).cloneContents());c.appendTo(e,g);this.appendUrlToImages(e);d.selectNode(e);a.removeAllRanges();a.addRange(d);setTimeout(function(){c.destroyNode(e);b.state.set({duplication:!1})},0)},checkSelection:function(a){a=a.target||a.srcElement;var d=window.getSelection().toString(),b;(d.replace(/^\s+|\s+$/g,"").length||this.hasImage())&&"TEXTAREA"!==a.nodeName&&"INPUT"!==a.nodeName&&(this.checkForUrl(d.replace(/^\s+|\s+$/g,""))||(b=
d));return b},hasImage:function(){var a=!1,b=window.getSelection().getRangeAt(0).cloneContents().querySelectorAll("img");return b.length?a=this.checkSizeImages(b):a},checkSizeImages:function(a){var d=b.state.get("imageSize"),e=!1;c.each(a,function(a){document.body.appendChild(a);d[1]<=a.offsetHeight&&d[0]<=a.offsetWidth&&(e=!0);document.body.removeChild(a)});return e},checkForUrl:function(a){return(/(https?:\/\/[^\s]+)/g.test(a)||0===a.indexOf("www"))&&-1===a.indexOf(" ")},getUrlForCopyPaste:function(a,
d){var e=c.removeTrackingParameter(c.getCanonicalUrl()||c.getWindowProperty("location.href"));return b.ext.getSharingURL({pageURL:d||e,sGUID:a,track:b.ext.pwConfig.val("track"),service:{id:"99"},transformations:{shorten:!1,tracking:b.ext.pwConfig.val("defaults.transformations.tracking")}})}};return{init:function(){b.subscribe("copypaste.init",function(a){f.init(a.options)});b.subscribe("copypaste.update",function(){f.update()})},destroy:function(){f.destroy()}}});